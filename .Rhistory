demo()
install.packages("devtools")
devtools::install_github("hadley/haven")
install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
install.packages("devtools", dependencies = TRUE)
devtools::install_github("hadley/haven")
library("devtools", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")
devtools::install_github("hadley/haven")
options(unzip = 'internal')
devtools::install_github("hadley/haven")
install.packages(c("curl", "devtools", "lintr", "testthat"))
install.packages("sp")
demo(topic, package = NULL, lib.loc = NULL,
character.only = FALSE, verbose = getOption("verbose"),
echo = TRUE, ask = getOption("demo.ask"),
encoding = getOption("encoding"))
setwd("/media/kd/Data/Dropbox/Repos/rds")
source("source/postgis_functions.r")
con <- odbcConnect("cdrcdb", uid = "postgres", pwd="kd")
import_or_append(con, "/media/kd/Data/Repos/rds/s_data", "oa2011", "england_oa_2011_gen.shp")
con <- odbcConnect("cdrcdb", uid = "postgres", pwd="kd")
import_or_append(con, "/media/kd/Data/Dropbox/Repos/rds/s_data", "oa2011", "england_oa_2011_gen.shp")
import_or_append(con, "/media/kd/Data/Dropbox/Repos/rds/s_data", "lads", "district_borough_unitary_region.shp")
csv_types[1] <- ("LEP","varchar")
csv_types[1] <- c("LEP","varchar")
csv_types <- c(("LEP","varchar"),("LA_Name","varchar"))
csv_types <- list("LEP varchar","LA_Name varchar")
csv_types <- "LEP varchar, LA_Name varchar, ONS_LACode_old varchar, ONS_LACode_new varchar, mLEPs integer"
source("source/postgis_functions.r")
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/s_data", "leps_lut","leps.csv",csv_types,"|")
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
table_name <- "table"
working_dir <- "/root"
csv_name <- "leps.csv"
sep <- "|"
query <- paste("COPY ", table_name, " FROM '", working_dir, "/", csv_name, "' DELIMITER '", sep,"' CSV", ";", sep = "")
source("source/postgis_functions.r")
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
source("source/postgis_functions.r")
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
source("source/postgis_functions.r")
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
query <- paste('COPY ', table_name, ' FROM "', working_dir, '/', csv_name, '" DELIMITER "', sep,'" CSV', ';', sep = '')
query <- paste('COPY ', table_name, ' FROM "', working_dir, '/', csv_name, '" DELIMITER "', sep,'" CSV', ';', sep = "")
source("source/postgis_functions.r")
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
s2p <- paste('shp2pgsql -c -s 27700 -W "latin1" -I "', working_dir, '/', shp_names[1], '" ', table_name, ' | psql -U ', username, ' -d ', db_name, ' -w', sep="")
query <- paste('COPY ', table_name, ' FROM "', working_dir, '/', csv_name, '" DELIMITER "', sep,'" CSV', ";", sep = "")
shp_names_ext <- "ext.shp"
s2p <- paste('shp2pgsql -c -s 27700 -W "latin1" -I "', working_dir, '/', shp_names[1], '" ', table_name, ' | psql -U ', username, ' -d ', db_name, ' -w', sep="")
shp_names <- "ext.shp"
s2p <- paste('shp2pgsql -c -s 27700 -W "latin1" -I "', working_dir, '/', shp_names[1], '" ', table_name, ' | psql -U ', username, ' -d ', db_name, ' -w', sep="")
source("source/postgis_functions.r")
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
con <- odbcConnect("cdrcdb", uid = "postgres", pwd="kd")
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
query <- paste('COPY ', table_name, ' FROM "', working_dir, '/', csv_name, '" DELIMITER "', sep,'" CSV', ";", sep = "")
con <- odbcConnect("cdrcdb", uid = "postgres", pwd="kd")
csv_types <- "lep varchar, la_name varchar, ons_lacode_old varchar, ons_lacode_new varchar, mleps integer"
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
csv_types <- "lep varchar, la_name varchar, ons_lacode_old varchar, ons_lacode_new varchar, mleps varchar"
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
con <- odbcConnect("cdrcdb", uid = "postgres", pwd="kd")
csv_types <- "lep varchar, la_name varchar, ons_lacode_old varchar, ons_lacode_new varchar, mleps varchar"
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
source("source/postgis_functions.r")
con <- odbcConnect("cdrcdb", uid = "postgres", pwd="kd")
csv_types <- "lep varchar, la_name varchar, ons_lacode_old varchar, ons_lacode_new varchar, mleps varchar"
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
source("source/postgis_functions.r")
library(rgeos)
library(rgdal)
library(dplyr)
db <- create_db("cdrcdb", "postgres", "kd")
con <- odbcConnect("cdrcdb", uid = "postgres", pwd="kd")
import_or_append(con, "/media/kd/Data/Dropbox/Repos/rds/s_data", "oa2011", "england_oa_2011_gen.shp")
import_or_append(con, "/media/kd/Data/Dropbox/Repos/rds/s_data", "lads", "district_borough_unitary_region.shp")
csv_types <- "lep varchar, la_name varchar, ons_lacode_old varchar, ons_lacode_new varchar, mleps integer"
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
leps_lut <- read.csv("/media/kd/Data/Repos/rds/LEPs/leps.csv", sep="|")
leps_lut <- read.csv("/media/kd/Data/Dropbox/Repos/rds/leps.csv", sep="|")
leps_lut <- read.csv("/media/kd/Data/Dropbox/Repos/rds/LEPs/leps.csv", sep="|")
View(leps_lut)
leps_lut[leps_lut,"Cumbria"]
leps_lut(leps_lut,"Cumbria")
leps_lut[leps_lut["Cumbria"]]
leps_lut[leps_lut$lep, "Cumbria"]
leps_lut[leps_lut$lep "Cumbria"]
leps_lut[leps_lut$lep, "Cumbria",4]
leps_lut[leps_lut$lep = "Cumbria", 4]
leps_lut[leps_lut$lep == "Cumbria", 4]
sub <-leps_lut[leps_lut$lep == "Cumbria", 4]
sub
sub
sub <- as.character(sub)
sub
unique(leps_lut$lep)
as.character(unique(leps_lut$lep))
unique(leps_lut$lep)
source("source/postgis_functions.r")
con <- odbcConnect("cdrcdb", uid = "postgres", pwd="kd")
csv_types <- "lep varchar, la_name varchar, ons_lacode_old varchar, ons_lacode_new varchar, mleps integer"
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
con <- odbcConnect("cdrcdb", uid = "postgres", pwd="kd")
odbcQuery(con, "DROP TABLE IF EXISTS lad_lep;")
odbcQuery(con, "CREATE TABLE lad_lep AS SELECT * FROM lads RIGHT JOIN leps_lut ON (leps_lut.ons_lacode_new = lads.code);")
odbcQuery(con, "DROP TABLE IF EXISTS leps_fin;")
odbcQuery(con, "CREATE TABLE leps_fin AS SELECT ST_UnaryUnion(ST_Collect(geom)), lad_lep.lep FROM lad_lep  GROUP BY lad_lep.lep;")
leps_ids <- read.csv("/media/kd/Data/Dropbox/Repos/rds/LEPs/lepids.csv", sep="|")
leps_ids <- read.csv("/media/kd/Data/Dropbox/Repos/rds/LEPs/lepids.csv", sep="|")
View(leps_ids)
leps_ids <- read.csv("/media/kd/Data/Dropbox/Repos/rds/LEPs/lepids.csv", sep="|", colClasses = c("character", "character"))
View(leps_ids)
View(leps_lut)
system('pgsql2shp -f /media/kd/Data/Dropbox/Repos/rds/LEPs/data/leps.shp -h localhost -u postgres -P kd cdrcdb "SELECT * FROM leps_fin"')
csv_types <- "lep varchar, la_name varchar, ons_lacode_old varchar, ons_lacode_new varchar, mleps integer, lepid varchar"
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
con <- odbcConnect("cdrcdb", uid = "postgres", pwd="kd")
csv_types <- "lep varchar, la_name varchar, ons_lacode_old varchar, ons_lacode_new varchar, mleps integer, lepid varchar"
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
source("source/postgis_functions.r")
csv_types <- "lep varchar, la_name varchar, ons_lacode_old varchar, ons_lacode_new varchar, mleps integer, lepid varchar"
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
con <- odbcConnect("cdrcdb", uid = "postgres", pwd="kd")
csv_types <- "lep varchar, la_name varchar, ons_lacode_old varchar, ons_lacode_new varchar, mleps integer, lepid varchar"
import_csv(con,"/media/kd/Data/Dropbox/Repos/rds/LEPs", "leps_lut","leps.csv",csv_types,"|")
odbcQuery(con, "DROP TABLE IF EXISTS lad_lep;")
odbcQuery(con, "CREATE TABLE lad_lep AS SELECT * FROM lads RIGHT JOIN leps_lut ON (leps_lut.ons_lacode_new = lads.code);")
odbcQuery(con, "DROP TABLE IF EXISTS leps_fin;")
odbcQuery(con, "CREATE TABLE leps_fin AS SELECT ST_UnaryUnion(ST_Collect(geom)), lad_lep.lepid, lad_lep.lep FROM lad_lep  GROUP BY lad_lep.lep;")
odbcQuery(con, "DROP TABLE IF EXISTS leps_fin;")
odbcQuery(con, "CREATE TABLE leps_fin AS SELECT ST_UnaryUnion(ST_Collect(geom)), lad_lep.lepid, lad_lep.lep FROM lad_lep  GROUP BY lad_lep.lep;")
system('pgsql2shp -f /media/kd/Data/Dropbox/Repos/rds/LEPs/data/leps.shp -h localhost -u postgres -P kd cdrcdb "SELECT * FROM leps_fin"')
setwd("/media/kd/Data/Dropbox/Repos/rds/")
lookup <- read.csv("~/m_code/ckan/lookup.csv")
lookup <- read.csv("m_code/ckan/lookup.csv")
lookup_lad <- unique(lookup[,c("LAD11CD", "LAD11NM")])
View(lookup_lad)
leps_lut <- read.csv(paste(getwd(),"/LEPs/leps.csv", sep = ""), sep="|")
View(leps_lut)
system(paste0('pgsql2shp -f ', getwd(), '/LEPs/data/leps.shp -h localhost -u ', username, ' -P kd ', db_name,' "SELECT * FROM leps_fin"'))
system(paste0('pgsql2shp -f ', getwd(), '/LEPs/data/leps.shp -h localhost -u ', username, ' -P kd ', db_name,' "SELECT * FROM leps_fin"'))
username <- unlist(strsplit(unlist(strsplit(attributes(con)$connection.string, ";"))[5], "="))[2]
db_name <- unlist(strsplit(unlist(strsplit(attributes(con)$connection.string, ";"))[2], "="))[2]
system(paste0('pgsql2shp -f ', getwd(), '/LEPs/data/leps.shp -h localhost -u ', username, ' -P kd ', db_name,' "SELECT * FROM leps_fin"'))
lookup_lad$LAD11CDLEPS <- lookup_lad$LAD11CD
lookup_lad <- unique(lookup[,c("LAD11CD", "LAD11NM")])
lookup_lad$LAD11LEPS <- lookup_lad$LAD11CD
lookup_lad$LAD11LEPS <- ifelse(lookup_lad$LAD11CD=="E09000097","E09000242",lookup_lad$LAD11CD)
lookup_lad$LAD11LEPS <- ifelse(lookup_lad$LAD11CD=="E09000097","E09000242",lookup_lad$LAD11CD)
lookup_lad$LAD11LEPS <- ifelse(lookup_lad$LAD11CD=="E09000097",lookup_lad$LAD11LEPS="E09000242",lookup_lad$LAD11LEPS=lookup_lad$LAD11CD)
lookup_lad$LAD11LEPS <- ifelse(lookup_lad$LAD11CD=="E09000097",lookup_lad$LAD11LEPS<-"E09000242",lookup_lad$LAD11LEPS<-lookup_lad$LAD11CD)
ifelse(lookup_lad$LAD11CD=="E09000097","E09000242",lookup_lad$LAD11CD)
str(lookup_lad$LAD11CD)
lookup_lad$LAD11LEPS <- ifelse(lookup_lad$LAD11CD=="E09000097","E09000242", as.character(lookup_lad$LAD11CD))
lookup_lad$LAD11LEPS <- ifelse(lookup_lad$LAD11CD=="E07000097","E07000242", as.character(lookup_lad$LAD11CD))
lookup_lad$LAD11LEPS <- ifelse(lookup_lad$LAD11CD=="E07000097","E07000242",
ifelse(lookup_lad$LAD11CD=="E07000100","E07000240",
ifelse(lookup_lad$LAD11CD=="E07000101","E07000243",
ifelse(lookup_lad$LAD11CD=="E07000104","E07000241", as.character(lookup_lad$LAD11CD)))))
lookup <- read.csv("m_code/ckan/lookup.csv")
View(lookup)
leps_lut <- read.csv(paste(getwd(),"/LEPs/leps.csv", sep = ""), sep="|")
leps_ids <- read.csv(paste(getwd(),"/LEPs/lepids.csv", sep = ""), sep="|", colClasses = c("character", "character"))
leps_lut$lepid <- leps_ids[match(leps_lut$lep, leps_ids$lepname),1]
write.table(leps_lut, file = paste(getwd(),"/LEPs/leps.csv", sep = ""), row.names=FALSE, quote = FALSE, na="", sep="|")
View(leps_lut)
lookup <- read.csv("m_code/ckan/lookup.csv")
lookup_lad <- unique(lookup[,c("LAD11CD", "LAD11NM")])
lookup_lad$LAD11LEPS <- ifelse(lookup_lad$LAD11CD=="E07000097","E07000242",
ifelse(lookup_lad$LAD11CD=="E07000100","E07000240",
ifelse(lookup_lad$LAD11CD=="E07000101","E07000243",
ifelse(lookup_lad$LAD11CD=="E07000104","E07000241", as.character(lookup_lad$LAD11CD)))))
View(lookup_lad)
View(leps_ids)
View(lookup)
View(lookup_lad)
variables_description <- read.csv("D:/Dropbox/Repos/rds/s_data/england_wales_zip/Adur/variables_description.csv")
View(variables_description)
unique(variables_description$ColumnVariableMeasurementUnit)
unique(variables_description$DatasetId)
View(variables_description)
var_desc <- read.csv("m_code/ckan/var_desc.csv")
View(var_desc)
pg_tables <- unique(var_desc$DatasetId)
pg_cols <- paste(var_desc$ColumnVariableCode, ifelse(var_desc$ColumnVariableMeasurementUnit == "Sum", "integer",
ifelse(var_desc$ColumnVariableMeasurementUnit == "Ratio", "decimal",
ifelse(var_desc$ColumnVariableMeasurementUnit == "Percentage", "decimal",
ifelse(var_desc$ColumnVariableMeasurementUnit == "Years", "integer",
ifelse(var_desc$ColumnVariableMeasurementUnit == "Average", "decimal","integer"))))), sep = " ")
pg_cols[2]
pg_cols[90]
pg_cols[100]
grep("CT0010",pg_cols)
as.character(grep("CT0010",pg_cols))
grep("CT0010",pg_cols, value=TRUE)
paste(grep("CT0010",pg_cols, value=TRUE), sep = ", ")
t <- grep("CT0010",pg_cols, value=TRUE)
paste(t, sep = ", ")
t<- as.character(t)
t
paste(t, sep = ", ")
paste(grep("CT0010",pg_cols, value=TRUE), sep = ", ", collapse = '')
paste(grep("CT0010",pg_cols, value=TRUE), collapse = ', ')
for (i in 1:nrow(pg_tables)){
var_lst <- paste(grep(pg_tables[i],pg_cols, value=TRUE), collapse = ', ')
}
pg_tables[1]
pg_tables <- dataframe(unique(var_desc$DatasetId))
pg_tables <- as.dataframe(unique(var_desc$DatasetId))
pg_tables <- data.frame(unique(var_desc$DatasetId))
View(pg_tables)
for (i in 1:nrow(pg_tables)){
var_lst <- paste(grep(pg_tables[i],pg_cols, value=TRUE), collapse = ', ')
}
pg_tables <- unique(var_desc$DatasetId)
pg_tables <- data.frame(pg_tables)
for (i in 1:nrow(pg_tables)){
var_lst <- paste(grep(pg_tables[i],pg_cols, value=TRUE), collapse = ', ')
}
for (i in 1:nrow(pg_tables$pg_tables)){
var_lst <- paste(grep(pg_tables[i],pg_cols, value=TRUE), collapse = ', ')
}
for (i in 1:nrow(pg_tables[1])){
var_lst <- paste(grep(pg_tables[i],pg_cols, value=TRUE), collapse = ', ')
}
for (i in 1:nrow(pg_tables[1])){
var_lst <- paste(grep(pg_tables$pg_tables[i],pg_cols, value=TRUE), collapse = ', ')
}
for (i in 1:nrow(pg_tables$pg_tables)){
var_lst <- paste(grep(pg_tables$pg_tables[i],pg_cols, value=TRUE), collapse = ', ')
}
for (i in 1:nrow(pg_tables$pg_tables[1])){
var_lst <- paste(grep(pg_tables$pg_tables[i],pg_cols, value=TRUE), collapse = ', ')
}
for (i in 1:nrow(pg_tables[1])){
var_lst <- paste(grep(pg_tables$pg_tables[i],pg_cols, value=TRUE), collapse = ', ')
}
View(lookup_lad)
